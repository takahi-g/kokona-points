<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã“ãªãƒã‚¤ãƒ³ãƒˆ</title>
    <link rel="apple-touch-icon" href="icon3.png">
    <link rel="icon" type="image/png" href="icon3.png">
    <meta name="apple-mobile-web-app-title" content="ã‚³ã‚³ãƒŠï¼">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #fff0f5; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        h1 { font-size: 22px; color: #ff1493; margin-bottom: 15px; }
        .next-goal { font-size: 18px; color: #e91e63; font-weight: bold; margin-bottom: 20px; background: #ffe4e1; padding: 10px; border-radius: 10px; }
        .point-display { font-size: 50px; color: #ff69b4; font-weight: bold; margin: 15px 0; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #ffb6c1; width: 85%; margin-bottom: 10px; font-size: 16px; box-sizing: border-box; }
        button { background: #ff69b4; color: white; border: none; padding: 12px; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer; width: 85%; margin: 5px 0; }
        
        .log { text-align: left; margin-top: 20px; }
        .month-section { margin-top: 15px; }
        /* æœˆã”ã¨ã®ãƒ©ãƒ™ãƒ«ï¼ˆãƒ•ã‚©ãƒ«ãƒ€åˆ†ã‘é¢¨ï¼‰ */
        .month-title { background: #ffb6c1; color: white; padding: 5px 10px; border-radius: 5px; font-size: 14px; font-weight: bold; display: inline-block; }
        
        .log ul { list-style: none; padding: 0; margin-top: 5px; }
        .log li { padding: 10px; border-bottom: 1px dotted #eee; cursor: pointer; font-size: 15px; color: #555; background: white; }
        .edit-hint { font-size: 11px; color: #999; margin-bottom: 5px; }
        .reset-btn { background: #f0f0f0; color: #999; font-size: 12px; margin-top: 30px; width: auto; padding: 5px 15px; border-radius: 10px; border: none; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ã“ã“ãªãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰</h1>
        <div class="next-goal" id="next-message">ã‚ã¨ 10 ãƒã‚¤ãƒ³ãƒˆï¼</div>
        <div class="point-display"><span id="points">0</span> pt</div>
        <input type="text" id="memo" placeholder="ãªã«ã‚’ã—ãŸï¼Ÿ">
        <button onclick="addPoint()">ãƒã‚¤ãƒ³ãƒˆGETï¼</button>
        
        <div class="log">
            <strong>ğŸŒ¸ ãŒã‚“ã°ã£ãŸè¨˜éŒ²ï¼š</strong>
            <p class="edit-hint">ï¼ˆã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ç›´ã›ã‚‹ã‚ˆï¼‰</p>
            <div id="log-container"></div>
        </div>
        
        <button class="reset-btn" onclick="resetPoints()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
        let currentPoints = 0;
        let logs = []; // å„ãƒ­ã‚°ã¯ {date: "2026/01/16", text: "ãŠçš¿æ´—ã„", id: 12345} ã¿ãŸã„ãªå½¢å¼
        const GOAL = 10;

        window.onload = function() {
            const savedPoints = localStorage.getItem('kokonaPoints');
            const savedLogs = localStorage.getItem('kokonaLogs');
            if (savedPoints) {
                currentPoints = parseInt(savedPoints);
                document.getElementById('points').innerText = currentPoints;
            }
            if (savedLogs) {
                logs = JSON.parse(savedLogs);
                updateLogDisplay();
            }
            updateGoalMessage();
        };

        function updateGoalMessage() {
            const msgElement = document.getElementById('next-message');
            const remaining = GOAL - (currentPoints % GOAL || (currentPoints >= GOAL ? 0 : 0)); 
            // ç°¡æ˜“çš„ã«10ã”ã¨ã«ãƒªã‚»ãƒƒãƒˆè¨ˆç®—ã€‚å®Ÿéš›ã¯é”æˆæ„Ÿé‡è¦–ã§èª¿æ•´å¯èƒ½
            const nextTarget = GOAL - (currentPoints % GOAL);
            msgElement.innerText = currentPoints >= GOAL && currentPoints % GOAL === 0 ? "ğŸ‰ é”æˆãŠã‚ã§ã¨ã†ï¼ ğŸ‰" : "ã‚ã¨ " + (GOAL - (currentPoints % GOAL)) + " ãƒã‚¤ãƒ³ãƒˆï¼";
        }

        function addPoint() {
            const memoInput = document.getElementById('memo');
            if (memoInput.value === "") { alert("å†…å®¹ã‚’å…¥ã‚Œã¦ã­ï¼"); return; }
            
            currentPoints++;
            document.getElementById('points').innerText = currentPoints;
            
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            
            const newEntry = {
                id: Date.now(),
                yearMonth: year + "å¹´" + month + "æœˆ",
                day: month + "/" + date,
                text: memoInput.value
            };
            
            logs.unshift(newEntry);
            saveData();
            updateLogDisplay();
            updateGoalMessage();
            memoInput.value = "";
            
            if (currentPoints % GOAL === 0) {
                alert("ãŠã‚ã§ã¨ã†ï¼ãƒ‘ãƒ‘ã‹ã‚‰ã”è¤’ç¾ã ã­ï¼");
            }
        }

        function editLog(id) {
            const index = logs.findIndex(l => l.id === id);
            const newText = prompt("å†…å®¹ã‚’ãªãŠã™ã‚ˆï¼š", logs[index].text);
            if (newText !== null && newText !== "") {
                logs[index].text = newText;
                saveData();
                updateLogDisplay();
            }
        }

        function updateLogDisplay() {
            const container = document.getElementById('log-container');
            container.innerHTML = "";
            
            // æœˆã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const groups = {};
            logs.forEach(log => {
                if (!groups[log.yearMonth]) groups[log.yearMonth] = [];
                groups[log.yearMonth].push(log);
            });

            // æœˆã”ã¨ã®è¡¨ç¤ºã‚’ä½œæˆ
            for (const month in groups) {
                const section = document.createElement('div');
                section.className = 'month-section';
                
                const title = document.createElement('div');
                title.className = 'month-title';
                title.innerText = month;
                section.appendChild(title);
                
                const ul = document.createElement('ul');
                groups[month].forEach(log => {
                    const li = document.createElement('li');
                    li.innerText = "âœ¨ " + log.day + " - " + log.text;
                    li.onclick = function() { editLog(log.id); };
                    ul.appendChild(li);
                });
                section.appendChild(ul);
                container.appendChild(section);
            }
        }

        function saveData() {
            localStorage.setItem('kokonaPoints', currentPoints);
            localStorage.setItem('kokonaLogs', JSON.stringify(logs));
        }

        function resetPoints() {
            if (confirm("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¦ã„ã„ï¼Ÿï¼ˆä»Šã¾ã§ã®è¨˜éŒ²ã‚‚æ¶ˆãˆã¡ã‚ƒã†ã‚ˆï¼‰")) {
                currentPoints = 0;
                logs = [];
                saveData();
                document.getElementById('points').innerText = currentPoints;
                updateLogDisplay();
                updateGoalMessage();
            }
        }
    </script>
</body>
</html>
