<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã“ãªãƒã‚¤ãƒ³ãƒˆ</title>
    <link rel="apple-touch-icon" href="icon3.png">
    <link rel="icon" type="image/png" href="icon3.png">
    <meta name="apple-mobile-web-app-title" content="ã‚³ã‚³ãƒŠï¼">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #fff0f5; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        h1 { font-size: 22px; color: #ff1493; margin-bottom: 15px; }
        .next-goal { font-size: 18px; color: #e91e63; font-weight: bold; margin-bottom: 20px; background: #ffe4e1; padding: 10px; border-radius: 10px; }
        .point-display { font-size: 50px; color: #ff69b4; font-weight: bold; margin: 15px 0; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #ffb6c1; width: 85%; margin-bottom: 10px; font-size: 16px; box-sizing: border-box; }
        .get-btn { background: #ff69b4; color: white; border: none; padding: 12px; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer; width: 85%; margin: 5px 0; }
        #congrats-msg { display: none; color: #ff1493; font-size: 24px; font-weight: bold; margin-top: 10px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }
        .log { text-align: left; margin-top: 20px; }
        .month-section { margin-top: 15px; }
        .month-title { background: #ffb6c1; color: white; padding: 5px 10px; border-radius: 5px; font-size: 14px; font-weight: bold; display: inline-block; }
        .log ul { list-style: none; padding: 0; margin-top: 5px; }
        .log li { padding: 10px; border-bottom: 1px dotted #eee; display: flex; justify-content: space-between; align-items: center; font-size: 15px; color: #555; background: white; }
        .del-btn { background: #eee; color: #999; border: none; border-radius: 5px; padding: 5px 10px; font-size: 12px; cursor: pointer; margin-left: 10px; }
        .reset-area { margin-top: 20px; display: none; padding: 15px; background: #fff9c4; border-radius: 10px; }
        .reset-btn { background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ã“ã“ãªãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰</h1>
        <div id="congrats-msg">ğŸ‰ 10ãƒã‚¤ãƒ³ãƒˆé”æˆï¼ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</div>
        <div class="next-goal" id="next-message">ã‚ã¨ 10 ãƒã‚¤ãƒ³ãƒˆï¼</div>
        <div class="point-display"><span id="points">0</span> pt</div>
        <div id="input-area">
            <input type="text" id="memo" placeholder="ãªã«ã‚’ã—ãŸï¼Ÿ">
            <button class="get-btn" onclick="addPoint()">ãƒã‚¤ãƒ³ãƒˆGETï¼</button>
        </div>
        <div id="reset-area" class="reset-area">
            <p style="margin:0 0 10px 0; color: #d32f2f; font-weight: bold;">ãƒ‘ãƒ‘ã€ãƒªã‚»ãƒƒãƒˆãŠã­ãŒã„ï¼</p>
            <button class="reset-btn" onclick="resetPoints()">0ã«æˆ»ã—ã¦ã‚ã’ã‚‹</button>
        </div>
        <div class="log">
            <strong>ğŸŒ¸ ãŒã‚“ã°ã£ãŸè¨˜éŒ²ï¼š</strong>
            <div id="log-container"></div>
        </div>
    </div>

    <script>
        let currentPoints = 0;
        let logs = [];
        const GOAL = 10;

        window.onload = function() {
            const savedPoints = localStorage.getItem('kokonaPoints');
            const savedLogs = localStorage.getItem('kokonaLogs');
            if (savedPoints) { currentPoints = parseInt(savedPoints); document.getElementById('points').innerText = currentPoints; }
            if (savedLogs) { logs = JSON.parse(savedLogs); updateLogDisplay(); }
            checkGoal();
        };

        function addPoint() {
            const memoInput = document.getElementById('memo');
            if (memoInput.value === "") { alert("å†…å®¹ã‚’å…¥ã‚Œã¦ã­ï¼"); return; }
            currentPoints++;
            document.getElementById('points').innerText = currentPoints;
            const now = new Date();
            const entry = {
                id: Date.now(),
                yearMonth: now.getFullYear() + "å¹´" + (now.getMonth() + 1) + "æœˆ",
                day: (now.getMonth() + 1) + "/" + now.getDate(),
                text: memoInput.value
            };
            logs.unshift(entry);
            saveData();
            updateLogDisplay();
            memoInput.value = "";
            checkGoal();
        }

        function checkGoal() {
            const nextMsg = document.getElementById('next-message');
            const congratsMsg = document.getElementById('congrats-msg');
            const inputArea = document.getElementById('input-area');
            const resetArea = document.getElementById('reset-area');
            if (currentPoints >= GOAL) {
                nextMsg.style.display = 'none'; congratsMsg.style.display = 'block';
                inputArea.style.display = 'none'; resetArea.style.display = 'block';
                launchConfetti();
            } else {
                nextMsg.style.display = 'block'; nextMsg.innerText = "ã‚ã¨ " + (GOAL - currentPoints) + " ãƒã‚¤ãƒ³ãƒˆï¼";
                congratsMsg.style.display = 'none'; inputArea.style.display = 'block'; resetArea.style.display = 'none';
            }
        }

        function launchConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff69b4', '#ff1493', '#fff', '#ffc0cb'] });
        }

        function editLog(id) {
            const index = logs.findIndex(l => l.id === id);
            const entry = logs[index];
            const newDate = prompt("æ—¥ä»˜ã‚’ãªãŠã™ï¼Ÿ", entry.day);
            if (newDate === null) return;
            const newText = prompt("å†…å®¹ã‚’ãªãŠã™ã‚ˆï¼š", entry.text);
            if (newText === null) return;
            if (newDate !== "" && newText !== "") {
                logs[index].day = newDate;
                logs[index].text = newText;
                saveData(); updateLogDisplay();
            }
        }

        function deleteLog(id, event) {
            event.stopPropagation();
            if (confirm("ã“ã®è¨˜éŒ²ã‚’æ¶ˆã—ã¦ã‚‚ã„ã„ï¼Ÿï¼ˆãƒã‚¤ãƒ³ãƒˆã‚‚1æ¸›ã‚‹ã‚ˆï¼‰")) {
                const index = logs.findIndex(l => l.id === id);
                logs.splice(index, 1);
                if (currentPoints > 0) currentPoints--;
                document.getElementById('points').innerText = currentPoints;
                saveData(); updateLogDisplay(); checkGoal();
            }
        }

        function updateLogDisplay() {
            const container = document.getElementById('log-container');
            container.innerHTML = "";
            const groups = {};
            logs.forEach(log => {
                if (!groups[log.yearMonth]) groups[log.yearMonth] = [];
                groups[log.yearMonth].push(log);
            });
            for (const month in groups) {
                const section = document.createElement('div');
                section.className = 'month-section';
                const title = document.createElement('div');
                title.className = 'month-title'; title.innerText = month;
                section.appendChild(title);
                const ul = document.createElement('ul');
                groups[month].forEach(log => {
                    const li = document.createElement('li');
                    li.onclick = function() { editLog(log.id); };
                    li.innerHTML = `<span>âœ¨ ${log.day} - ${log.text}</span>
                                    <button class="del-btn" onclick="deleteLog(${log.id}, event)">æ¶ˆã™</button>`;
                    ul.appendChild(li);
                });
                section.appendChild(ul);
                container.appendChild(section);
            }
        }

        function saveData() {
            localStorage.setItem('kokonaPoints', currentPoints);
            localStorage.setItem('kokonaLogs', JSON.stringify(logs));
        }

        function resetPoints() {
            if (confirm("ã”è¤’ç¾ã¯ã‚ã’ãŸã‹ãªï¼Ÿãƒã‚¤ãƒ³ãƒˆã‚’0ã«æˆ»ã™ã‚ˆï¼")) {
                currentPoints = 0; saveData();
                document.getElementById('points').innerText = "0"; checkGoal();
            }
        }
    </script>
</body>
</html>
